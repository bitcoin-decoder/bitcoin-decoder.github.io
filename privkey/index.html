<!DOCTYPE html>
<html>
<head>
  <title>BTC Key Converter</title>
  <script src="https://cdn.jsdelivr.net/gh/xloem/bitcoinjs-lib-browser@master/bitcoinjs.min.js"></script>
</head>
<body>
  <h2>BTC Private Key to Addresses</h2>
  <input type="text" id="priv" placeholder="Enter WIF or 64-char hex" size="70">
  <button onclick="convert()">Convert</button>

  <pre id="out"></pre>

  <script>
    async function convert() {
      const input = document.getElementById('priv').value.trim();
      const out = document.getElementById('out');
      out.textContent = "Processing...\n";

      try {
        let hex, wif, kpC, kpU;

        // If WIF
        if (/^[5KL][A-HJ-NP-Za-km-z1-9]{50,51}$/.test(input)) {
          const keyPair = bitcoinjs.ECPair.fromWIF(input);
          wif = input;
          hex = keyPair.privateKey.toString('hex');
          kpC = bitcoinjs.ECPair.fromPrivateKey(keyPair.privateKey, { compressed: true });
          kpU = bitcoinjs.ECPair.fromPrivateKey(keyPair.privateKey, { compressed: false });
        }
        // If HEX
        else if (/^[0-9a-fA-F]{64}$/.test(input)) {
          const priv = bitcoinjs.Buffer.from(input, 'hex');
          hex = input;
          kpC = bitcoinjs.ECPair.fromPrivateKey(priv, { compressed: true });
          kpU = bitcoinjs.ECPair.fromPrivateKey(priv, { compressed: false });
          wif = kpC.toWIF(); 
        }
        else {
          throw new Error("Not valid WIF or 64-char hex");
        }

        const { address: addrC } = bitcoinjs.payments.p2pkh({ pubkey: kpC.publicKey });
        const { address: addrU } = bitcoinjs.payments.p2pkh({ pubkey: kpU.publicKey });

        // Fetch balances
        async function getInfo(addr) {
          const url = `https://blockstream.info/api/address/${addr}`;
          const res = await fetch(url);
          if (!res.ok) return { balance: "?", txcount: "?" };
          const data = await res.json();
          return {
            balance: (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) / 1e8,
            txcount: data.chain_stats.tx_count
          };
        }

        const infoC = await getInfo(addrC);
        const infoU = await getInfo(addrU);

        out.textContent =
          "Addresses\n" +
          `Compressed:   ${addrC}  (Balance: ${infoC.balance} BTC, TX: ${infoC.txcount})\n` +
          `Uncompressed: ${addrU}  (Balance: ${infoU.balance} BTC, TX: ${infoU.txcount})\n\n` +
          `Private Key (hex): ${hex}\n` +
          `Private Key (WIF): ${wif}\n`;
      } catch (e) {
        out.textContent = "Error: " + e.message;
      }
    }
  </script>
</body>
</html>
